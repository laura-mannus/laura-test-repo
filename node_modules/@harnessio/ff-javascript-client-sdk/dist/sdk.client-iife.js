var HarnessFFSDK=(()=>{var tt=Object.create,Te=Object.defineProperty,nt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty,it=Object.getOwnPropertyNames,at=Object.getOwnPropertyDescriptor;var te=Object.assign,ot=n=>Te(n,"__esModule",{value:!0});var st=(n,i)=>()=>(i||(i={exports:{}},n(i.exports,i)),i.exports),ft=(n,i)=>{for(var v in i)Te(n,v,{get:i[v],enumerable:!0})},dt=(n,i,v)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of it(i))!rt.call(n,d)&&d!=="default"&&Te(n,d,{get:()=>i[d],enumerable:!(v=at(i,d))||v.enumerable});return n},ct=n=>dt(ot(Te(n!=null?tt(nt(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Ce=(n,i,v)=>new Promise((d,F)=>{var A=O=>{try{_(v.next(O))}catch(q){F(q)}},k=O=>{try{_(v.throw(O))}catch(q){F(q)}},_=O=>O.done?d(O.value):Promise.resolve(O.value).then(A,k);_((v=v.apply(n,i)).next())});var Be=st((He,Ie)=>{(function(n){"use strict";var i=n.setTimeout,v=n.clearTimeout,d=n.XMLHttpRequest,F=n.XDomainRequest,A=n.ActiveXObject,k=n.EventSource,_=n.document,O=n.Promise,q=n.fetch,ce=n.Response,C=n.TextDecoder,D=n.TextEncoder,J=n.AbortController;if(typeof window!="undefined"&&typeof _!="undefined"&&!("readyState"in _)&&_.body==null&&(_.readyState="loading",window.addEventListener("load",function(e){_.readyState="complete"},!1)),d==null&&A!=null&&(d=function(){return new A("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Date.now||(Date.now=function(){return new Date().getTime()}),J==null){var N=q;q=function(e,r){var o=r.signal;return N(e,{headers:r.headers,credentials:r.credentials,cache:r.cache}).then(function(t){var u=t.body.getReader();return o._reader=u,o._aborted&&o._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return u}}}})},J=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function ne(){this.bitsNeeded=0,this.codePoint=0}ne.prototype.decode=function(e){function r(E,y,l){if(l===1)return E>=128>>y&&E<<y<=2047;if(l===2)return E>=2048>>y&&E<<y<=55295||E>=57344>>y&&E<<y<=65535;if(l===3)return E>=65536>>y&&E<<y<=1114111;throw new Error}function o(E,y){if(E===6*1)return y>>6>15?3:y>31?2:1;if(E===6*2)return y>15?3:2;if(E===6*3)return 3;throw new Error}for(var t=65533,u="",s=this.bitsNeeded,h=this.codePoint,w=0;w<e.length;w+=1){var g=e[w];s!==0&&(g<128||g>191||!r(h<<6|g&63,s-6,o(s,h)))&&(s=0,h=t,u+=String.fromCharCode(h)),s===0?(g>=0&&g<=127?(s=0,h=g):g>=192&&g<=223?(s=6*1,h=g&31):g>=224&&g<=239?(s=6*2,h=g&15):g>=240&&g<=247?(s=6*3,h=g&7):(s=0,h=t),s!==0&&!r(h,s,o(s,h))&&(s=0,h=t)):(s-=6,h=h<<6|g&63),s===0&&(h<=65535?u+=String.fromCharCode(h):(u+=String.fromCharCode(55296+(h-65535-1>>10)),u+=String.fromCharCode(56320+(h-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=h,u};var Ne=function(){try{return new C().decode(new D().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(C==null||D==null||!Ne())&&(C=ne);var L=function(){};function b(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=L,this.onload=L,this.onerror=L,this.onreadystatechange=L,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=L}b.prototype.open=function(e,r){this._abort(!0);var o=this,t=this._xhr,u=1,s=0;this._abort=function(l){o._sendTimeout!==0&&(v(o._sendTimeout),o._sendTimeout=0),(u===1||u===2||u===3)&&(u=4,t.onload=L,t.onerror=L,t.onabort=L,t.onprogress=L,t.onreadystatechange=L,t.abort(),s!==0&&(v(s),s=0),l||(o.readyState=4,o.onabort(null),o.onreadystatechange())),u=0};var h=function(){if(u===1){var l=0,S="",W=void 0;if("contentType"in t)l=200,S="OK",W=t.contentType;else try{l=t.status,S=t.statusText,W=t.getResponseHeader("Content-Type")}catch(ge){l=0,S="",W=void 0}l!==0&&(u=2,o.readyState=2,o.status=l,o.statusText=S,o._contentType=W,o.onreadystatechange())}},w=function(){if(h(),u===2||u===3){u=3;var l="";try{l=t.responseText}catch(S){}o.readyState=3,o.responseText=l,o.onprogress()}},g=function(l,S){if((S==null||S.preventDefault==null)&&(S={preventDefault:L}),w(),u===1||u===2||u===3){if(u=4,s!==0&&(v(s),s=0),o.readyState=4,l==="load")o.onload(S);else if(l==="error")o.onerror(S);else if(l==="abort")o.onabort(S);else throw new TypeError;o.onreadystatechange()}},E=function(l){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&g(t.responseText===""?"error":"load",l):t.readyState===3?"onprogress"in t||w():t.readyState===2&&h())},y=function(){s=i(function(){y()},500),t.readyState===3&&w()};"onload"in t&&(t.onload=function(l){g("load",l)}),"onerror"in t&&(t.onerror=function(l){g("error",l)}),"onabort"in t&&(t.onabort=function(l){g("abort",l)}),"onprogress"in t&&(t.onprogress=w),"onreadystatechange"in t&&(t.onreadystatechange=function(l){E(l)}),("contentType"in t||!("ontimeout"in d.prototype))&&(r+=(r.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,r,!0),"readyState"in t&&(s=i(function(){y()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(e){return this._contentType},b.prototype.setRequestHeader=function(e,r){var o=this._xhr;"setRequestHeader"in o&&o.setRequestHeader(e,r)},b.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},b.prototype.send=function(){if((!("ontimeout"in d.prototype)||!("sendAsBinary"in d.prototype)&&!("mozAnon"in d.prototype))&&_!=null&&_.readyState!=null&&_.readyState!=="complete"){var e=this;e._sendTimeout=i(function(){e._sendTimeout=0,e.send()},4);return}var r=this._xhr;"withCredentials"in r&&(r.withCredentials=this.withCredentials);try{r.send(void 0)}catch(o){throw o}};function ue(e){return e.replace(/[A-Z]/g,function(r){return String.fromCharCode(r.charCodeAt(0)+32)})}function le(e){for(var r=Object.create(null),o=e.split(`\r
`),t=0;t<o.length;t+=1){var u=o[t],s=u.split(": "),h=s.shift(),w=s.join(": ");r[ue(h)]=w}this._map=r}le.prototype.get=function(e){return this._map[ue(e)]},d!=null&&d.HEADERS_RECEIVED==null&&(d.HEADERS_RECEIVED=2);function P(){}P.prototype.open=function(e,r,o,t,u,s,h){e.open("GET",u);var w=0;e.onprogress=function(){var E=e.responseText,y=E.slice(w);w+=y.length,o(y)},e.onerror=function(E){E.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===d.HEADERS_RECEIVED){var E=e.status,y=e.statusText,l=e.getResponseHeader("Content-Type"),S=e.getAllResponseHeaders();r(E,y,l,new le(S))}},e.withCredentials=s;for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&e.setRequestHeader(g,h[g]);return e.send(),e};function ve(e){this._headers=e}ve.prototype.get=function(e){return this._headers.get(e)};function he(){}he.prototype.open=function(e,r,o,t,u,s,h){var w=null,g=new J,E=g.signal,y=new C;return q(u,{headers:h,credentials:s?"include":"same-origin",signal:E,cache:"no-store"}).then(function(l){return w=l.body.getReader(),r(l.status,l.statusText,l.headers.get("Content-Type"),new ve(l.headers)),new O(function(S,W){var ge=function(){w.read().then(function($){if($.done)S(void 0);else{var j=y.decode($.value,{stream:!0});o(j),ge()}}).catch(function($){W($)})};ge()})}).catch(function(l){if(l.name!=="AbortError")return l}).then(function(l){t(l)}),{abort:function(){w!=null&&w.cancel(),g.abort()}}};function re(){this._listeners=Object.create(null)}function me(e){i(function(){throw e},0)}re.prototype.dispatchEvent=function(e){e.target=this;var r=this._listeners[e.type];if(r!=null)for(var o=r.length,t=0;t<o;t+=1){var u=r[t];try{typeof u.handleEvent=="function"?u.handleEvent(e):u.call(this,e)}catch(s){me(s)}}},re.prototype.addEventListener=function(e,r){e=String(e);var o=this._listeners,t=o[e];t==null&&(t=[],o[e]=t);for(var u=!1,s=0;s<t.length;s+=1)t[s]===r&&(u=!0);u||t.push(r)},re.prototype.removeEventListener=function(e,r){e=String(e);var o=this._listeners,t=o[e];if(t!=null){for(var u=[],s=0;s<t.length;s+=1)t[s]!==r&&u.push(t[s]);u.length===0?delete o[e]:o[e]=u}};function ee(e){this.type=e,this.target=void 0}function we(e,r){ee.call(this,e),this.data=r.data,this.lastEventId=r.lastEventId}we.prototype=Object.create(ee.prototype);function ae(e,r){ee.call(this,e),this.status=r.status,this.statusText=r.statusText,this.headers=r.headers}ae.prototype=Object.create(ee.prototype);function f(e,r){ee.call(this,e),this.error=r.error}f.prototype=Object.create(ee.prototype);var c=-1,a=0,p=1,T=2,R=-1,m=0,H=1,pe=2,Xe=3,qe=/^text\/event\-stream(;.*)?$/i,Je=1e3,ze=18e6,xe=function(e,r){var o=e==null?r:parseInt(e,10);return o!==o&&(o=r),Fe(o)},Fe=function(e){return Math.min(Math.max(e,Je),ze)},oe=function(e,r,o){try{typeof r=="function"&&r.call(e,o)}catch(t){me(t)}};function z(e,r){re.call(this),r=r||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Qe(this,e,r)}function We(){return d!=null&&"withCredentials"in d.prototype||F==null?new d:new F}var Ye=q!=null&&ce!=null&&"body"in ce.prototype;function Qe(e,r,o){r=String(r);var t=Boolean(o.withCredentials),u=o.lastEventIdQueryParameterName||"lastEventId",s=Fe(1e3),h=xe(o.heartbeatTimeout,45e3),w="",g=s,E=!1,y=0,l=o.headers||{},S=o.Transport,W=Ye&&S==null?void 0:new b(S!=null?new S:We()),ge=S!=null&&typeof S!="string"?new S:W==null?new he:new P,$=void 0,j=0,X=c,se="",Se="",Y="",be="",U=m,_e=0,ie=0,Ze=function(x,I,K,G){if(X===a)if(x===200&&K!=null&&qe.test(K)){X=p,E=Date.now(),g=s,e.readyState=p;var B=new ae("open",{status:x,statusText:I,headers:G});e.dispatchEvent(B),oe(e,e.onopen,B)}else{var M="";x!==200?(I&&(I=I.replace(/\s+/g," ")),M="EventSource's response has a status "+x+" "+I+" that is not 200. Aborting the connection."):M="EventSource's response has a Content-Type specifying an unsupported type: "+(K==null?"-":K.replace(/\s+/g," "))+". Aborting the connection.",Me();var B=new ae("error",{status:x,statusText:I,headers:G});e.dispatchEvent(B),oe(e,e.onerror,B),console.error(M)}},et=function(x){if(X===p){for(var I=-1,K=0;K<x.length;K+=1){var G=x.charCodeAt(K);(G===`
`.charCodeAt(0)||G==="\r".charCodeAt(0))&&(I=K)}var B=(I!==-1?be:"")+x.slice(0,I+1);be=(I===-1?be:"")+x.slice(I+1),x!==""&&(E=Date.now(),y+=x.length);for(var M=0;M<B.length;M+=1){var G=B.charCodeAt(M);if(U===R&&G===`
`.charCodeAt(0))U=m;else if(U===R&&(U=m),G==="\r".charCodeAt(0)||G===`
`.charCodeAt(0)){if(U!==m){U===H&&(ie=M+1);var Q=B.slice(_e,ie-1),Z=B.slice(ie+(ie<M&&B.charCodeAt(ie)===" ".charCodeAt(0)?1:0),M);Q==="data"?(se+=`
`,se+=Z):Q==="id"?Se=Z:Q==="event"?Y=Z:Q==="retry"?(s=xe(Z,s),g=s):Q==="heartbeatTimeout"&&(h=xe(Z,h),j!==0&&(v(j),j=i(function(){Ee()},h)))}if(U===m){if(se!==""){w=Se,Y===""&&(Y="message");var fe=new we(Y,{data:se.slice(1),lastEventId:Se});if(e.dispatchEvent(fe),Y==="open"?oe(e,e.onopen,fe):Y==="message"?oe(e,e.onmessage,fe):Y==="error"&&oe(e,e.onerror,fe),X===T)return}se="",Y=""}U=G==="\r".charCodeAt(0)?R:m}else U===m&&(_e=M,U=H),U===H?G===":".charCodeAt(0)&&(ie=M+1,U=pe):U===pe&&(U=Xe)}}},Le=function(x){if(X===p||X===a)X=c,j!==0&&(v(j),j=0),j=i(function(){Ee()},g),g=Fe(Math.min(s*16,g*2)),e.readyState=a;else if(X===T&&x!=null){console.error(x);var I=new f("error",{error:x});e.dispatchEvent(I),oe(e,e.onerror,I)}},Me=function(){X=T,$!=null&&($.abort(),$=void 0),j!==0&&(v(j),j=0),e.readyState=T},Ee=function(){if(j=0,X!==c){if(!E&&$!=null)Le(new Error("No activity within "+h+" milliseconds. "+(X===a?"No response received.":y+" chars received.")+" Reconnecting.")),$!=null&&($.abort(),$=void 0);else{var x=Math.max((E||Date.now())+h-Date.now(),1);E=!1,j=i(function(){Ee()},x)}return}E=!1,y=0,j=i(function(){Ee()},h),X=a,se="",Y="",Se=w,be="",_e=0,ie=0,U=m;var I=r;if(r.slice(0,5)!=="data:"&&r.slice(0,5)!=="blob:"&&w!==""){var K=r.indexOf("?");I=K===-1?r:r.slice(0,K+1)+r.slice(K+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(Z,fe){return fe===u?"":Z}),I+=(r.indexOf("?")===-1?"?":"&")+u+"="+encodeURIComponent(w)}var G=e.withCredentials,B={};B.Accept="text/event-stream";var M=e.headers;if(M!=null)for(var Q in M)Object.prototype.hasOwnProperty.call(M,Q)&&(B[Q]=M[Q]);try{$=ge.open(W,Ze,et,Le,I,G,B)}catch(Z){throw Me(),Z}};e.url=r,e.readyState=a,e.withCredentials=t,e.headers=l,e._close=Me,Ee()}z.prototype=Object.create(re.prototype),z.prototype.CONNECTING=a,z.prototype.OPEN=p,z.prototype.CLOSED=T,z.prototype.close=function(){this._close()},z.CONNECTING=a,z.OPEN=p,z.CLOSED=T,z.prototype.withCredentials=void 0;var ke=k;d!=null&&(k==null||!("withCredentials"in k.prototype))&&(ke=z),function(e){if(typeof Ie=="object"&&typeof Ie.exports=="object"){var r=e(He);r!==void 0&&(Ie.exports=r)}else typeof define=="function"&&define.amd?define(["exports"],e):e(n)}(function(e){e.EventSourcePolyfill=z,e.NativeEventSource=k,e.EventSource=ke})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:He:globalThis)});var vt={};ft(vt,{Event:()=>V,initialize:()=>Ge});function Ve(n){this.message=n}Ve.prototype=new Error,Ve.prototype.name="InvalidCharacterError";var Pe=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var i=String(n).replace(/=+$/,"");if(i.length%4==1)throw new Ve("'atob' failed: The string to be decoded is not correctly encoded.");for(var v,d,F=0,A=0,k="";d=i.charAt(A++);~d&&(v=F%4?64*v+d:d,F++%4)?k+=String.fromCharCode(255&v>>(-2*F&6)):0)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d);return k};function ut(n){var i=n.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(v){return decodeURIComponent(Pe(v).replace(/(.)/g,function(d,F){var A=F.charCodeAt(0).toString(16).toUpperCase();return A.length<2&&(A="0"+A),"%"+A}))}(i)}catch(v){return Pe(i)}}function Re(n){this.message=n}function lt(n,i){if(typeof n!="string")throw new Re("Invalid token specified");var v=(i=i||{}).header===!0?0:1;try{return JSON.parse(ut(n.split(".")[v]))}catch(d){throw new Re("Invalid token specified: "+d.message)}}Re.prototype=new Error,Re.prototype.name="InvalidTokenError";var je=lt;function Ue(n){return{all:n=n||new Map,on:function(i,v){var d=n.get(i);d&&d.push(v)||n.set(i,[v])},off:function(i,v){var d=n.get(i);d&&d.splice(d.indexOf(v)>>>0,1)},emit:function(i,v){(n.get(i)||[]).slice().map(function(d){d(v)}),(n.get("*")||[]).slice().map(function(d){d(i,v)})}}}var Ke=ct(Be());var V;(function(n){n.READY="ready",n.CONNECTED="connected",n.DISCONNECTED="disconnected",n.CHANGED="changed",n.ERROR="error"})(V||(V={}));var $e={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},de=(n,...i)=>console.error(`[FF-SDK] ${n}`,...i),Ae=30*1e3;var ht="1.4.11",pt=500,Oe=globalThis.fetch,gt=Ke.EventSourcePolyfill,ye=!!globalThis.Proxy,De=n=>{let{value:i}=n;try{switch(n.kind.toLowerCase()){case"int":case"number":i=Number(i);break;case"boolean":i=i.toString().toLowerCase()==="true";break;case"json":i=JSON.parse(i);break}}catch(v){de(v)}return i},Ge=(n,i,v)=>{let d,F,A,k,_,O=!0,q=()=>{O=!1},ce=()=>{O=!0},C=[],D=Ue(),J=te(te({},$e),v),N=(f,...c)=>{J.debug&&console.debug(`[FF-SDK] ${f}`,...c)},ne=f=>{if(O){let c=Date.now();c-f.lastAccessed>pt&&(f.count++,f.lastAccessed=c)}};globalThis.onbeforeunload=()=>{C.length&&globalThis.localStorage&&(q(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(C),ce())};let Ne=(f,c)=>Ce(void 0,null,function*(){return(yield(yield Oe(`${c.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:f,target:i})})).json()).authToken}),L=()=>{if(C.length){N("Sending metrics...",{metrics:C,evaluations:b});let f={metricsData:C.map(c=>({timestamp:Date.now(),count:c.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:c.featureIdentifier},{key:"featureName",value:c.featureIdentifier},{key:"variationIdentifier",value:c.variationIdentifier},{key:"target",value:i.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:ht}]}))};Oe(`${J.eventUrl}/metrics/${d}?cluster=${F}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(f)}).then(()=>{C=[]}).catch(c=>{N(c)}).finally(()=>{_=window.setTimeout(L,Ae)})}else _=window.setTimeout(L,Ae)},b={},ue=f=>{N("Sending event for",f.flag),ye?D.emit(V.CHANGED,new Proxy(f,{get(c,a){var p;if(c.hasOwnProperty(a)&&a==="value"){let T=c.flag,R=f.value,m=C.find(H=>H.featureIdentifier===T&&H.featureValue===R);m?(ne(m),m.variationIdentifier=((p=b[T])==null?void 0:p.identifier)||""):C.push({featureIdentifier:T,featureValue:String(R),variationIdentifier:b[T].identifier||"",count:O?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag",a,"has been read with value via stream update",R)}return a==="value"?De(f):f[a]}})):D.emit(V.CHANGED,{deleted:f.deleted,flag:f.flag,value:De(f)})},le=function(){return ye?new Proxy({},{get(f,c){var p,T,R;let a=f[c];if(f.hasOwnProperty(c)){let m=f[c],H=C.find(pe=>pe.featureIdentifier===c&&m===pe.featureValue);H?(H.variationIdentifier=((p=b[c])==null?void 0:p.identifier)||"",ne(H)):C.push({featureIdentifier:c,featureValue:m,variationIdentifier:((T=b[c])==null?void 0:T.identifier)||"",count:O?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag:",c,"has been read with value:",m,"variationIdentifier:",(R=b[c])==null?void 0:R.identifier)}return a}}):{}},P=le();Ne(n,J).then(f=>{k=f;let c=je(f);if(N("Authenticated",c),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,N("Picking up metrics from previous session")}catch(a){}_=window.setTimeout(L,Ae),d=c.environment,F=c.clusterIdentifier,ve().then(()=>{N("Fetch all flags ok",P)}).then(()=>{re()}).then(()=>{N("Event stream ready",{storage:P}),D.emit(V.READY,te({},P)),ye||Object.keys(P).forEach(a=>{var p;C.push({featureIdentifier:a,featureValue:P[a],variationIdentifier:((p=b[a])==null?void 0:p.identifier)||"",count:O?1:0,lastAccessed:Date.now()})})}).catch(a=>{D.emit(V.ERROR,a)})}).catch(f=>{de("Authentication error: ",f),D.emit(V.ERROR,f)});let ve=()=>Ce(void 0,null,function*(){try{(yield(yield Oe(`${J.baseUrl}/client/env/${d}/target/${i.identifier}/evaluations?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`}})).json()).forEach(a=>{let p=De(a),T=P[a.flag];p!==T&&(N("Flag variation has changed for ",a.identifier),P[a.flag]=p,b[a.flag]=te(te({},a),{value:p}),ue(a))})}catch(f){return de("Features fetch operation error: ",f),D.emit(V.ERROR,f),f}}),he=f=>Ce(void 0,null,function*(){var c;try{let a=yield Oe(`${J.baseUrl}/client/env/${d}/target/${i.identifier}/evaluations/${f}?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`}});if(a.ok){let p=yield a.json(),T=De(p);if(q(),P[f]=T,b[f]=te(te({},p),{value:T}),ce(),ue(p),!ye){let R=p.flag,m=C.find(H=>H.featureIdentifier===R&&H.featureValue===p.value);m?(ne(m),m.variationIdentifier=((c=b[R])==null?void 0:c.identifier)||""):C.push({featureIdentifier:R,featureValue:String(p.value),variationIdentifier:b[R].identifier||"",count:O?1:0,lastAccessed:Date.now()})}}else D.emit(V.ERROR,a)}catch(a){de("Feature fetch operation error: ",a),D.emit(V.ERROR,a)}}),re=()=>{if(!J.streamEnabled){N("Stream is disabled by configuration. Note: Polling is not yet supported");return}A=new gt(`${J.baseUrl}/stream?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`,"API-Key":n}}),A.onopen=a=>{N("Stream connected",a),D.emit(V.CONNECTED)},A.onclose=a=>{N("Stream disconnected"),D.emit(V.DISCONNECTED)},A.onerror=a=>{de("Stream has issue",a),D.emit(V.ERROR,a)};let f=a=>{switch(a.event){case"create":setTimeout(()=>he(a.identifier),1e3);break;case"patch":he(a.identifier);break;case"delete":delete P[a.identifier],D.emit(V.CHANGED,{flag:a.identifier,value:void 0,deleted:!0}),N("Evaluation deleted",{message:a,storage:P});break}},c=a=>{a.event==="patch"&&ve()};A.addEventListener("*",a=>{let p=JSON.parse(a.data);N("Received event from stream: ",p),p.domain==="flag"?f(p):p.domain==="target-segment"&&c(p)})},me=(f,c)=>D.on(f,c),ee=(f,c)=>{f?D.off(f,c):ae()},we=(f,c)=>{var p;let a=P[f];if(!ye&&a!==void 0){let T=a,R=f,m=C.find(H=>H.featureIdentifier===R&&H.featureValue===T);m?(ne(m),m.variationIdentifier=((p=b[R])==null?void 0:p.identifier)||""):C.push({featureIdentifier:R,featureValue:T,count:O?1:0,variationIdentifier:b[R].identifier||"",lastAccessed:Date.now()})}return a!==void 0?a:c},ae=()=>{N("Closing event stream"),P=le(),b={},clearTimeout(_),D.all.clear(),A.close()};return{on:me,off:ee,variation:we,close:ae}};return vt;})();
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
//# sourceMappingURL=sdk.client-iife.js.map
