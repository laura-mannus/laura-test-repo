var Ze=Object.create,Te=Object.defineProperty,et=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty,nt=Object.getOwnPropertyNames,rt=Object.getOwnPropertyDescriptor;var te=Object.assign,Pe=a=>Te(a,"__esModule",{value:!0});var it=(a,u)=>()=>(u||(u={exports:{}},a(u.exports,u)),u.exports),at=(a,u)=>{for(var T in u)Te(a,T,{get:u[T],enumerable:!0})},ot=(a,u,T)=>{if(u&&typeof u=="object"||typeof u=="function")for(let g of nt(u))!tt.call(a,g)&&g!=="default"&&Te(a,g,{get:()=>u[g],enumerable:!(T=rt(u,g))||T.enumerable});return a},Me=a=>ot(Pe(Te(a!=null?Ze(et(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var Re=(a,u,T)=>new Promise((g,G)=>{var X=O=>{try{F(T.next(O))}catch(q){G(q)}},$=O=>{try{F(T.throw(O))}catch(q){G(q)}},F=O=>O.done?g(O.value):Promise.resolve(O.value).then(X,$);F((T=T.apply(a,u)).next())});var je=it((Ve,Ce)=>{(function(a){"use strict";var u=a.setTimeout,T=a.clearTimeout,g=a.XMLHttpRequest,G=a.XDomainRequest,X=a.ActiveXObject,$=a.EventSource,F=a.document,O=a.Promise,q=a.fetch,ce=a.Response,R=a.TextDecoder,I=a.TextEncoder,J=a.AbortController;if(typeof window!="undefined"&&typeof F!="undefined"&&!("readyState"in F)&&F.body==null&&(F.readyState="loading",window.addEventListener("load",function(e){F.readyState="complete"},!1)),g==null&&X!=null&&(g=function(){return new X("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),J==null){var D=q;q=function(e,n){var i=n.signal;return D(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(t){var d=t.body.getReader();return i._reader=d,i._aborted&&i._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return d}}}})},J=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function ne(){this.bitsNeeded=0,this.codePoint=0}ne.prototype.decode=function(e){function n(p,E,c){if(c===1)return p>=128>>E&&p<<E<=2047;if(c===2)return p>=2048>>E&&p<<E<=55295||p>=57344>>E&&p<<E<=65535;if(c===3)return p>=65536>>E&&p<<E<=1114111;throw new Error}function i(p,E){if(p===6*1)return E>>6>15?3:E>31?2:1;if(p===6*2)return E>15?3:2;if(p===6*3)return 3;throw new Error}for(var t=65533,d="",o=this.bitsNeeded,l=this.codePoint,m=0;m<e.length;m+=1){var h=e[m];o!==0&&(h<128||h>191||!n(l<<6|h&63,o-6,i(o,l)))&&(o=0,l=t,d+=String.fromCharCode(l)),o===0?(h>=0&&h<=127?(o=0,l=h):h>=192&&h<=223?(o=6*1,l=h&31):h>=224&&h<=239?(o=6*2,l=h&15):h>=240&&h<=247?(o=6*3,l=h&7):(o=0,l=t),o!==0&&!n(l,o,i(o,l))&&(o=0,l=t)):(o-=6,l=l<<6|h&63),o===0&&(l<=65535?d+=String.fromCharCode(l):(d+=String.fromCharCode(55296+(l-65535-1>>10)),d+=String.fromCharCode(56320+(l-65535-1&1023))))}return this.bitsNeeded=o,this.codePoint=l,d};var De=function(){try{return new R().decode(new I().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(R==null||I==null||!De())&&(R=ne);var V=function(){};function b(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=V,this.onload=V,this.onerror=V,this.onreadystatechange=V,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=V}b.prototype.open=function(e,n){this._abort(!0);var i=this,t=this._xhr,d=1,o=0;this._abort=function(c){i._sendTimeout!==0&&(T(i._sendTimeout),i._sendTimeout=0),(d===1||d===2||d===3)&&(d=4,t.onload=V,t.onerror=V,t.onabort=V,t.onprogress=V,t.onreadystatechange=V,t.abort(),o!==0&&(T(o),o=0),c||(i.readyState=4,i.onabort(null),i.onreadystatechange())),d=0};var l=function(){if(d===1){var c=0,S="",W=void 0;if("contentType"in t)c=200,S="OK",W=t.contentType;else try{c=t.status,S=t.statusText,W=t.getResponseHeader("Content-Type")}catch(ge){c=0,S="",W=void 0}c!==0&&(d=2,i.readyState=2,i.status=c,i.statusText=S,i._contentType=W,i.onreadystatechange())}},m=function(){if(l(),d===2||d===3){d=3;var c="";try{c=t.responseText}catch(S){}i.readyState=3,i.responseText=c,i.onprogress()}},h=function(c,S){if((S==null||S.preventDefault==null)&&(S={preventDefault:V}),m(),d===1||d===2||d===3){if(d=4,o!==0&&(T(o),o=0),i.readyState=4,c==="load")i.onload(S);else if(c==="error")i.onerror(S);else if(c==="abort")i.onabort(S);else throw new TypeError;i.onreadystatechange()}},p=function(c){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&h(t.responseText===""?"error":"load",c):t.readyState===3?"onprogress"in t||m():t.readyState===2&&l())},E=function(){o=u(function(){E()},500),t.readyState===3&&m()};"onload"in t&&(t.onload=function(c){h("load",c)}),"onerror"in t&&(t.onerror=function(c){h("error",c)}),"onabort"in t&&(t.onabort=function(c){h("abort",c)}),"onprogress"in t&&(t.onprogress=m),"onreadystatechange"in t&&(t.onreadystatechange=function(c){p(c)}),("contentType"in t||!("ontimeout"in g.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,n,!0),"readyState"in t&&(o=u(function(){E()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(e){return this._contentType},b.prototype.setRequestHeader=function(e,n){var i=this._xhr;"setRequestHeader"in i&&i.setRequestHeader(e,n)},b.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},b.prototype.send=function(){if((!("ontimeout"in g.prototype)||!("sendAsBinary"in g.prototype)&&!("mozAnon"in g.prototype))&&F!=null&&F.readyState!=null&&F.readyState!=="complete"){var e=this;e._sendTimeout=u(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(i){throw i}};function ue(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function le(e){for(var n=Object.create(null),i=e.split(`\r
`),t=0;t<i.length;t+=1){var d=i[t],o=d.split(": "),l=o.shift(),m=o.join(": ");n[ue(l)]=m}this._map=n}le.prototype.get=function(e){return this._map[ue(e)]},g!=null&&g.HEADERS_RECEIVED==null&&(g.HEADERS_RECEIVED=2);function H(){}H.prototype.open=function(e,n,i,t,d,o,l){e.open("GET",d);var m=0;e.onprogress=function(){var p=e.responseText,E=p.slice(m);m+=E.length,i(E)},e.onerror=function(p){p.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===g.HEADERS_RECEIVED){var p=e.status,E=e.statusText,c=e.getResponseHeader("Content-Type"),S=e.getAllResponseHeaders();n(p,E,c,new le(S))}},e.withCredentials=o;for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&e.setRequestHeader(h,l[h]);return e.send(),e};function ve(e){this._headers=e}ve.prototype.get=function(e){return this._headers.get(e)};function he(){}he.prototype.open=function(e,n,i,t,d,o,l){var m=null,h=new J,p=h.signal,E=new R;return q(d,{headers:l,credentials:o?"include":"same-origin",signal:p,cache:"no-store"}).then(function(c){return m=c.body.getReader(),n(c.status,c.statusText,c.headers.get("Content-Type"),new ve(c.headers)),new O(function(S,W){var ge=function(){m.read().then(function(k){if(k.done)S(void 0);else{var L=E.decode(k.value,{stream:!0});i(L),ge()}}).catch(function(k){W(k)})};ge()})}).catch(function(c){if(c.name!=="AbortError")return c}).then(function(c){t(c)}),{abort:function(){m!=null&&m.cancel(),h.abort()}}};function re(){this._listeners=Object.create(null)}function me(e){u(function(){throw e},0)}re.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var i=n.length,t=0;t<i;t+=1){var d=n[t];try{typeof d.handleEvent=="function"?d.handleEvent(e):d.call(this,e)}catch(o){me(o)}}},re.prototype.addEventListener=function(e,n){e=String(e);var i=this._listeners,t=i[e];t==null&&(t=[],i[e]=t);for(var d=!1,o=0;o<t.length;o+=1)t[o]===n&&(d=!0);d||t.push(n)},re.prototype.removeEventListener=function(e,n){e=String(e);var i=this._listeners,t=i[e];if(t!=null){for(var d=[],o=0;o<t.length;o+=1)t[o]!==n&&d.push(t[o]);d.length===0?delete i[e]:i[e]=d}};function ee(e){this.type=e,this.target=void 0}function Se(e,n){ee.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}Se.prototype=Object.create(ee.prototype);function ae(e,n){ee.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}ae.prototype=Object.create(ee.prototype);function s(e,n){ee.call(this,e),this.error=n.error}s.prototype=Object.create(ee.prototype);var f=-1,r=0,v=1,w=2,C=-1,y=0,x=1,pe=2,Ke=3,Ge=/^text\/event\-stream(;.*)?$/i,Xe=1e3,qe=18e6,Ne=function(e,n){var i=e==null?n:parseInt(e,10);return i!==i&&(i=n),Fe(i)},Fe=function(e){return Math.min(Math.max(e,Xe),qe)},oe=function(e,n,i){try{typeof n=="function"&&n.call(e,i)}catch(t){me(t)}};function z(e,n){re.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,We(this,e,n)}function Je(){return g!=null&&"withCredentials"in g.prototype||G==null?new g:new G}var ze=q!=null&&ce!=null&&"body"in ce.prototype;function We(e,n,i){n=String(n);var t=Boolean(i.withCredentials),d=i.lastEventIdQueryParameterName||"lastEventId",o=Fe(1e3),l=Ne(i.heartbeatTimeout,45e3),m="",h=o,p=!1,E=0,c=i.headers||{},S=i.Transport,W=ze&&S==null?void 0:new b(S!=null?new S:Je()),ge=S!=null&&typeof S!="string"?new S:W==null?new he:new H,k=void 0,L=0,K=f,se="",be="",Y="",we="",P=y,_e=0,ie=0,Ye=function(N,A,B,U){if(K===r)if(N===200&&B!=null&&Ge.test(B)){K=v,p=Date.now(),h=o,e.readyState=v;var j=new ae("open",{status:N,statusText:A,headers:U});e.dispatchEvent(j),oe(e,e.onopen,j)}else{var _="";N!==200?(A&&(A=A.replace(/\s+/g," ")),_="EventSource's response has a status "+N+" "+A+" that is not 200. Aborting the connection."):_="EventSource's response has a Content-Type specifying an unsupported type: "+(B==null?"-":B.replace(/\s+/g," "))+". Aborting the connection.",xe();var j=new ae("error",{status:N,statusText:A,headers:U});e.dispatchEvent(j),oe(e,e.onerror,j),console.error(_)}},Qe=function(N){if(K===v){for(var A=-1,B=0;B<N.length;B+=1){var U=N.charCodeAt(B);(U===`
`.charCodeAt(0)||U==="\r".charCodeAt(0))&&(A=B)}var j=(A!==-1?we:"")+N.slice(0,A+1);we=(A===-1?we:"")+N.slice(A+1),N!==""&&(p=Date.now(),E+=N.length);for(var _=0;_<j.length;_+=1){var U=j.charCodeAt(_);if(P===C&&U===`
`.charCodeAt(0))P=y;else if(P===C&&(P=y),U==="\r".charCodeAt(0)||U===`
`.charCodeAt(0)){if(P!==y){P===x&&(ie=_+1);var Q=j.slice(_e,ie-1),Z=j.slice(ie+(ie<_&&j.charCodeAt(ie)===" ".charCodeAt(0)?1:0),_);Q==="data"?(se+=`
`,se+=Z):Q==="id"?be=Z:Q==="event"?Y=Z:Q==="retry"?(o=Ne(Z,o),h=o):Q==="heartbeatTimeout"&&(l=Ne(Z,l),L!==0&&(T(L),L=u(function(){Ee()},l)))}if(P===y){if(se!==""){m=be,Y===""&&(Y="message");var fe=new Se(Y,{data:se.slice(1),lastEventId:be});if(e.dispatchEvent(fe),Y==="open"?oe(e,e.onopen,fe):Y==="message"?oe(e,e.onmessage,fe):Y==="error"&&oe(e,e.onerror,fe),K===w)return}se="",Y=""}P=U==="\r".charCodeAt(0)?C:y}else P===y&&(_e=_,P=x),P===x?U===":".charCodeAt(0)&&(ie=_+1,P=pe):P===pe&&(P=Ke)}}},Le=function(N){if(K===v||K===r)K=f,L!==0&&(T(L),L=0),L=u(function(){Ee()},h),h=Fe(Math.min(o*16,h*2)),e.readyState=r;else if(K===w&&N!=null){console.error(N);var A=new s("error",{error:N});e.dispatchEvent(A),oe(e,e.onerror,A)}},xe=function(){K=w,k!=null&&(k.abort(),k=void 0),L!==0&&(T(L),L=0),e.readyState=w},Ee=function(){if(L=0,K!==f){if(!p&&k!=null)Le(new Error("No activity within "+l+" milliseconds. "+(K===r?"No response received.":E+" chars received.")+" Reconnecting.")),k!=null&&(k.abort(),k=void 0);else{var N=Math.max((p||Date.now())+l-Date.now(),1);p=!1,L=u(function(){Ee()},N)}return}p=!1,E=0,L=u(function(){Ee()},l),K=r,se="",Y="",be=m,we="",_e=0,ie=0,P=y;var A=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&m!==""){var B=n.indexOf("?");A=B===-1?n:n.slice(0,B+1)+n.slice(B+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(Z,fe){return fe===d?"":Z}),A+=(n.indexOf("?")===-1?"?":"&")+d+"="+encodeURIComponent(m)}var U=e.withCredentials,j={};j.Accept="text/event-stream";var _=e.headers;if(_!=null)for(var Q in _)Object.prototype.hasOwnProperty.call(_,Q)&&(j[Q]=_[Q]);try{k=ge.open(W,Ye,Qe,Le,A,U,j)}catch(Z){throw xe(),Z}};e.url=n,e.readyState=r,e.withCredentials=t,e.headers=c,e._close=xe,Ee()}z.prototype=Object.create(re.prototype),z.prototype.CONNECTING=r,z.prototype.OPEN=v,z.prototype.CLOSED=w,z.prototype.close=function(){this._close()},z.CONNECTING=r,z.OPEN=v,z.CLOSED=w,z.prototype.withCredentials=void 0;var He=$;g!=null&&($==null||!("withCredentials"in $.prototype))&&(He=z),function(e){if(typeof Ce=="object"&&typeof Ce.exports=="object"){var n=e(Ve);n!==void 0&&(Ce.exports=n)}else typeof define=="function"&&define.amd?define(["exports"],e):e(a)}(function(e){e.EventSourcePolyfill=z,e.NativeEventSource=$,e.EventSource=He})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:Ve:globalThis)});Pe(exports);at(exports,{Event:()=>M,initialize:()=>ct});var Be=Me(require("jwt-decode")),Ue=Me(require("mitt")),$e=Me(je());var M;(function(a){a.READY="ready",a.CONNECTED="connected",a.DISCONNECTED="disconnected",a.CHANGED="changed",a.ERROR="error"})(M||(M={}));var ke={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},de=(a,...u)=>console.error(`[FF-SDK] ${a}`,...u),Ae=30*1e3;var st="1.4.11",ft=500,Oe=globalThis.fetch,dt=$e.EventSourcePolyfill,ye=!!globalThis.Proxy,Ie=a=>{let{value:u}=a;try{switch(a.kind.toLowerCase()){case"int":case"number":u=Number(u);break;case"boolean":u=u.toString().toLowerCase()==="true";break;case"json":u=JSON.parse(u);break}}catch(T){de(T)}return u},ct=(a,u,T)=>{let g,G,X,$,F,O=!0,q=()=>{O=!1},ce=()=>{O=!0},R=[],I=(0,Ue.default)(),J=te(te({},ke),T),D=(s,...f)=>{J.debug&&console.debug(`[FF-SDK] ${s}`,...f)},ne=s=>{if(O){let f=Date.now();f-s.lastAccessed>ft&&(s.count++,s.lastAccessed=f)}};globalThis.onbeforeunload=()=>{R.length&&globalThis.localStorage&&(q(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(R),ce())};let De=(s,f)=>Re(void 0,null,function*(){return(yield(yield Oe(`${f.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s,target:u})})).json()).authToken}),V=()=>{if(R.length){D("Sending metrics...",{metrics:R,evaluations:b});let s={metricsData:R.map(f=>({timestamp:Date.now(),count:f.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:f.featureIdentifier},{key:"featureName",value:f.featureIdentifier},{key:"variationIdentifier",value:f.variationIdentifier},{key:"target",value:u.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:st}]}))};Oe(`${J.eventUrl}/metrics/${g}?cluster=${G}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${$}`},body:JSON.stringify(s)}).then(()=>{R=[]}).catch(f=>{D(f)}).finally(()=>{F=window.setTimeout(V,Ae)})}else F=window.setTimeout(V,Ae)},b={},ue=s=>{D("Sending event for",s.flag),ye?I.emit(M.CHANGED,new Proxy(s,{get(f,r){var v;if(f.hasOwnProperty(r)&&r==="value"){let w=f.flag,C=s.value,y=R.find(x=>x.featureIdentifier===w&&x.featureValue===C);y?(ne(y),y.variationIdentifier=((v=b[w])==null?void 0:v.identifier)||""):R.push({featureIdentifier:w,featureValue:String(C),variationIdentifier:b[w].identifier||"",count:O?1:0,lastAccessed:Date.now()}),D("Metrics event: Flag",r,"has been read with value via stream update",C)}return r==="value"?Ie(s):s[r]}})):I.emit(M.CHANGED,{deleted:s.deleted,flag:s.flag,value:Ie(s)})},le=function(){return ye?new Proxy({},{get(s,f){var v,w,C;let r=s[f];if(s.hasOwnProperty(f)){let y=s[f],x=R.find(pe=>pe.featureIdentifier===f&&y===pe.featureValue);x?(x.variationIdentifier=((v=b[f])==null?void 0:v.identifier)||"",ne(x)):R.push({featureIdentifier:f,featureValue:y,variationIdentifier:((w=b[f])==null?void 0:w.identifier)||"",count:O?1:0,lastAccessed:Date.now()}),D("Metrics event: Flag:",f,"has been read with value:",y,"variationIdentifier:",(C=b[f])==null?void 0:C.identifier)}return r}}):{}},H=le();De(a,J).then(s=>{$=s;let f=(0,Be.default)(s);if(D("Authenticated",f),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,D("Picking up metrics from previous session")}catch(r){}F=window.setTimeout(V,Ae),g=f.environment,G=f.clusterIdentifier,ve().then(()=>{D("Fetch all flags ok",H)}).then(()=>{re()}).then(()=>{D("Event stream ready",{storage:H}),I.emit(M.READY,te({},H)),ye||Object.keys(H).forEach(r=>{var v;R.push({featureIdentifier:r,featureValue:H[r],variationIdentifier:((v=b[r])==null?void 0:v.identifier)||"",count:O?1:0,lastAccessed:Date.now()})})}).catch(r=>{I.emit(M.ERROR,r)})}).catch(s=>{de("Authentication error: ",s),I.emit(M.ERROR,s)});let ve=()=>Re(void 0,null,function*(){try{(yield(yield Oe(`${J.baseUrl}/client/env/${g}/target/${u.identifier}/evaluations?cluster=${G}`,{headers:{Authorization:`Bearer ${$}`}})).json()).forEach(r=>{let v=Ie(r),w=H[r.flag];v!==w&&(D("Flag variation has changed for ",r.identifier),H[r.flag]=v,b[r.flag]=te(te({},r),{value:v}),ue(r))})}catch(s){return de("Features fetch operation error: ",s),I.emit(M.ERROR,s),s}}),he=s=>Re(void 0,null,function*(){var f;try{let r=yield Oe(`${J.baseUrl}/client/env/${g}/target/${u.identifier}/evaluations/${s}?cluster=${G}`,{headers:{Authorization:`Bearer ${$}`}});if(r.ok){let v=yield r.json(),w=Ie(v);if(q(),H[s]=w,b[s]=te(te({},v),{value:w}),ce(),ue(v),!ye){let C=v.flag,y=R.find(x=>x.featureIdentifier===C&&x.featureValue===v.value);y?(ne(y),y.variationIdentifier=((f=b[C])==null?void 0:f.identifier)||""):R.push({featureIdentifier:C,featureValue:String(v.value),variationIdentifier:b[C].identifier||"",count:O?1:0,lastAccessed:Date.now()})}}else I.emit(M.ERROR,r)}catch(r){de("Feature fetch operation error: ",r),I.emit(M.ERROR,r)}}),re=()=>{if(!J.streamEnabled){D("Stream is disabled by configuration. Note: Polling is not yet supported");return}X=new dt(`${J.baseUrl}/stream?cluster=${G}`,{headers:{Authorization:`Bearer ${$}`,"API-Key":a}}),X.onopen=r=>{D("Stream connected",r),I.emit(M.CONNECTED)},X.onclose=r=>{D("Stream disconnected"),I.emit(M.DISCONNECTED)},X.onerror=r=>{de("Stream has issue",r),I.emit(M.ERROR,r)};let s=r=>{switch(r.event){case"create":setTimeout(()=>he(r.identifier),1e3);break;case"patch":he(r.identifier);break;case"delete":delete H[r.identifier],I.emit(M.CHANGED,{flag:r.identifier,value:void 0,deleted:!0}),D("Evaluation deleted",{message:r,storage:H});break}},f=r=>{r.event==="patch"&&ve()};X.addEventListener("*",r=>{let v=JSON.parse(r.data);D("Received event from stream: ",v),v.domain==="flag"?s(v):v.domain==="target-segment"&&f(v)})},me=(s,f)=>I.on(s,f),ee=(s,f)=>{s?I.off(s,f):ae()},Se=(s,f)=>{var v;let r=H[s];if(!ye&&r!==void 0){let w=r,C=s,y=R.find(x=>x.featureIdentifier===C&&x.featureValue===w);y?(ne(y),y.variationIdentifier=((v=b[C])==null?void 0:v.identifier)||""):R.push({featureIdentifier:C,featureValue:w,count:O?1:0,variationIdentifier:b[C].identifier||"",lastAccessed:Date.now()})}return r!==void 0?r:f},ae=()=>{D("Closing event stream"),H=le(),b={},clearTimeout(F),I.all.clear(),X.close()};return{on:me,off:ee,variation:Se,close:ae}};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
//# sourceMappingURL=sdk.cjs.js.map
