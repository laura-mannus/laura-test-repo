var et=Object.create,Me=Object.defineProperty,tt=Object.getPrototypeOf,nt=Object.prototype.hasOwnProperty,rt=Object.getOwnPropertyNames,it=Object.getOwnPropertyDescriptor;var te=Object.assign,at=r=>Me(r,"__esModule",{value:!0});var ot=(r,o)=>()=>(o||(o={exports:{}},r(o.exports,o)),o.exports);var st=(r,o,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let d of rt(o))!nt.call(r,d)&&d!=="default"&&Me(r,d,{get:()=>o[d],enumerable:!(p=it(o,d))||p.enumerable});return r},ft=r=>st(at(Me(r!=null?et(tt(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var Te=(r,o,p)=>new Promise((d,F)=>{var A=O=>{try{_(p.next(O))}catch(q){F(q)}},k=O=>{try{_(p.throw(O))}catch(q){F(q)}},_=O=>O.done?d(O.value):Promise.resolve(O.value).then(A,k);_((p=p.apply(r,o)).next())});var Be=ot((He,Re)=>{(function(r){"use strict";var o=r.setTimeout,p=r.clearTimeout,d=r.XMLHttpRequest,F=r.XDomainRequest,A=r.ActiveXObject,k=r.EventSource,_=r.document,O=r.Promise,q=r.fetch,ce=r.Response,C=r.TextDecoder,D=r.TextEncoder,J=r.AbortController;if(typeof window!="undefined"&&typeof _!="undefined"&&!("readyState"in _)&&_.body==null&&(_.readyState="loading",window.addEventListener("load",function(e){_.readyState="complete"},!1)),d==null&&A!=null&&(d=function(){return new A("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),J==null){var N=q;q=function(e,n){var a=n.signal;return N(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(t){var u=t.body.getReader();return a._reader=u,a._aborted&&a._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return u}}}})},J=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function ne(){this.bitsNeeded=0,this.codePoint=0}ne.prototype.decode=function(e){function n(E,y,l){if(l===1)return E>=128>>y&&E<<y<=2047;if(l===2)return E>=2048>>y&&E<<y<=55295||E>=57344>>y&&E<<y<=65535;if(l===3)return E>=65536>>y&&E<<y<=1114111;throw new Error}function a(E,y){if(E===6*1)return y>>6>15?3:y>31?2:1;if(E===6*2)return y>15?3:2;if(E===6*3)return 3;throw new Error}for(var t=65533,u="",s=this.bitsNeeded,v=this.codePoint,w=0;w<e.length;w+=1){var g=e[w];s!==0&&(g<128||g>191||!n(v<<6|g&63,s-6,a(s,v)))&&(s=0,v=t,u+=String.fromCharCode(v)),s===0?(g>=0&&g<=127?(s=0,v=g):g>=192&&g<=223?(s=6*1,v=g&31):g>=224&&g<=239?(s=6*2,v=g&15):g>=240&&g<=247?(s=6*3,v=g&7):(s=0,v=t),s!==0&&!n(v,s,a(s,v))&&(s=0,v=t)):(s-=6,v=v<<6|g&63),s===0&&(v<=65535?u+=String.fromCharCode(v):(u+=String.fromCharCode(55296+(v-65535-1>>10)),u+=String.fromCharCode(56320+(v-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=v,u};var De=function(){try{return new C().decode(new D().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(C==null||D==null||!De())&&(C=ne);var L=function(){};function b(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=L,this.onload=L,this.onerror=L,this.onreadystatechange=L,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=L}b.prototype.open=function(e,n){this._abort(!0);var a=this,t=this._xhr,u=1,s=0;this._abort=function(l){a._sendTimeout!==0&&(p(a._sendTimeout),a._sendTimeout=0),(u===1||u===2||u===3)&&(u=4,t.onload=L,t.onerror=L,t.onabort=L,t.onprogress=L,t.onreadystatechange=L,t.abort(),s!==0&&(p(s),s=0),l||(a.readyState=4,a.onabort(null),a.onreadystatechange())),u=0};var v=function(){if(u===1){var l=0,S="",W=void 0;if("contentType"in t)l=200,S="OK",W=t.contentType;else try{l=t.status,S=t.statusText,W=t.getResponseHeader("Content-Type")}catch(ge){l=0,S="",W=void 0}l!==0&&(u=2,a.readyState=2,a.status=l,a.statusText=S,a._contentType=W,a.onreadystatechange())}},w=function(){if(v(),u===2||u===3){u=3;var l="";try{l=t.responseText}catch(S){}a.readyState=3,a.responseText=l,a.onprogress()}},g=function(l,S){if((S==null||S.preventDefault==null)&&(S={preventDefault:L}),w(),u===1||u===2||u===3){if(u=4,s!==0&&(p(s),s=0),a.readyState=4,l==="load")a.onload(S);else if(l==="error")a.onerror(S);else if(l==="abort")a.onabort(S);else throw new TypeError;a.onreadystatechange()}},E=function(l){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&g(t.responseText===""?"error":"load",l):t.readyState===3?"onprogress"in t||w():t.readyState===2&&v())},y=function(){s=o(function(){y()},500),t.readyState===3&&w()};"onload"in t&&(t.onload=function(l){g("load",l)}),"onerror"in t&&(t.onerror=function(l){g("error",l)}),"onabort"in t&&(t.onabort=function(l){g("abort",l)}),"onprogress"in t&&(t.onprogress=w),"onreadystatechange"in t&&(t.onreadystatechange=function(l){E(l)}),("contentType"in t||!("ontimeout"in d.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,n,!0),"readyState"in t&&(s=o(function(){y()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(e){return this._contentType},b.prototype.setRequestHeader=function(e,n){var a=this._xhr;"setRequestHeader"in a&&a.setRequestHeader(e,n)},b.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},b.prototype.send=function(){if((!("ontimeout"in d.prototype)||!("sendAsBinary"in d.prototype)&&!("mozAnon"in d.prototype))&&_!=null&&_.readyState!=null&&_.readyState!=="complete"){var e=this;e._sendTimeout=o(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(a){throw a}};function ue(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function le(e){for(var n=Object.create(null),a=e.split(`\r
`),t=0;t<a.length;t+=1){var u=a[t],s=u.split(": "),v=s.shift(),w=s.join(": ");n[ue(v)]=w}this._map=n}le.prototype.get=function(e){return this._map[ue(e)]},d!=null&&d.HEADERS_RECEIVED==null&&(d.HEADERS_RECEIVED=2);function P(){}P.prototype.open=function(e,n,a,t,u,s,v){e.open("GET",u);var w=0;e.onprogress=function(){var E=e.responseText,y=E.slice(w);w+=y.length,a(y)},e.onerror=function(E){E.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===d.HEADERS_RECEIVED){var E=e.status,y=e.statusText,l=e.getResponseHeader("Content-Type"),S=e.getAllResponseHeaders();n(E,y,l,new le(S))}},e.withCredentials=s;for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&e.setRequestHeader(g,v[g]);return e.send(),e};function ve(e){this._headers=e}ve.prototype.get=function(e){return this._headers.get(e)};function he(){}he.prototype.open=function(e,n,a,t,u,s,v){var w=null,g=new J,E=g.signal,y=new C;return q(u,{headers:v,credentials:s?"include":"same-origin",signal:E,cache:"no-store"}).then(function(l){return w=l.body.getReader(),n(l.status,l.statusText,l.headers.get("Content-Type"),new ve(l.headers)),new O(function(S,W){var ge=function(){w.read().then(function($){if($.done)S(void 0);else{var j=y.decode($.value,{stream:!0});a(j),ge()}}).catch(function($){W($)})};ge()})}).catch(function(l){if(l.name!=="AbortError")return l}).then(function(l){t(l)}),{abort:function(){w!=null&&w.cancel(),g.abort()}}};function re(){this._listeners=Object.create(null)}function me(e){o(function(){throw e},0)}re.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var a=n.length,t=0;t<a;t+=1){var u=n[t];try{typeof u.handleEvent=="function"?u.handleEvent(e):u.call(this,e)}catch(s){me(s)}}},re.prototype.addEventListener=function(e,n){e=String(e);var a=this._listeners,t=a[e];t==null&&(t=[],a[e]=t);for(var u=!1,s=0;s<t.length;s+=1)t[s]===n&&(u=!0);u||t.push(n)},re.prototype.removeEventListener=function(e,n){e=String(e);var a=this._listeners,t=a[e];if(t!=null){for(var u=[],s=0;s<t.length;s+=1)t[s]!==n&&u.push(t[s]);u.length===0?delete a[e]:a[e]=u}};function ee(e){this.type=e,this.target=void 0}function we(e,n){ee.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}we.prototype=Object.create(ee.prototype);function ae(e,n){ee.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}ae.prototype=Object.create(ee.prototype);function f(e,n){ee.call(this,e),this.error=n.error}f.prototype=Object.create(ee.prototype);var c=-1,i=0,h=1,T=2,R=-1,m=0,V=1,pe=2,Ge=3,Xe=/^text\/event\-stream(;.*)?$/i,qe=1e3,Je=18e6,Ne=function(e,n){var a=e==null?n:parseInt(e,10);return a!==a&&(a=n),xe(a)},xe=function(e){return Math.min(Math.max(e,qe),Je)},oe=function(e,n,a){try{typeof n=="function"&&n.call(e,a)}catch(t){me(t)}};function z(e,n){re.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Ye(this,e,n)}function ze(){return d!=null&&"withCredentials"in d.prototype||F==null?new d:new F}var We=q!=null&&ce!=null&&"body"in ce.prototype;function Ye(e,n,a){n=String(n);var t=Boolean(a.withCredentials),u=a.lastEventIdQueryParameterName||"lastEventId",s=xe(1e3),v=Ne(a.heartbeatTimeout,45e3),w="",g=s,E=!1,y=0,l=a.headers||{},S=a.Transport,W=We&&S==null?void 0:new b(S!=null?new S:ze()),ge=S!=null&&typeof S!="string"?new S:W==null?new he:new P,$=void 0,j=0,X=c,se="",Se="",Y="",be="",U=m,Fe=0,ie=0,Qe=function(x,I,K,G){if(X===i)if(x===200&&K!=null&&Xe.test(K)){X=h,E=Date.now(),g=s,e.readyState=h;var B=new ae("open",{status:x,statusText:I,headers:G});e.dispatchEvent(B),oe(e,e.onopen,B)}else{var M="";x!==200?(I&&(I=I.replace(/\s+/g," ")),M="EventSource's response has a status "+x+" "+I+" that is not 200. Aborting the connection."):M="EventSource's response has a Content-Type specifying an unsupported type: "+(K==null?"-":K.replace(/\s+/g," "))+". Aborting the connection.",_e();var B=new ae("error",{status:x,statusText:I,headers:G});e.dispatchEvent(B),oe(e,e.onerror,B),console.error(M)}},Ze=function(x){if(X===h){for(var I=-1,K=0;K<x.length;K+=1){var G=x.charCodeAt(K);(G===`
`.charCodeAt(0)||G==="\r".charCodeAt(0))&&(I=K)}var B=(I!==-1?be:"")+x.slice(0,I+1);be=(I===-1?be:"")+x.slice(I+1),x!==""&&(E=Date.now(),y+=x.length);for(var M=0;M<B.length;M+=1){var G=B.charCodeAt(M);if(U===R&&G===`
`.charCodeAt(0))U=m;else if(U===R&&(U=m),G==="\r".charCodeAt(0)||G===`
`.charCodeAt(0)){if(U!==m){U===V&&(ie=M+1);var Q=B.slice(Fe,ie-1),Z=B.slice(ie+(ie<M&&B.charCodeAt(ie)===" ".charCodeAt(0)?1:0),M);Q==="data"?(se+=`
`,se+=Z):Q==="id"?Se=Z:Q==="event"?Y=Z:Q==="retry"?(s=Ne(Z,s),g=s):Q==="heartbeatTimeout"&&(v=Ne(Z,v),j!==0&&(p(j),j=o(function(){Ee()},v)))}if(U===m){if(se!==""){w=Se,Y===""&&(Y="message");var fe=new we(Y,{data:se.slice(1),lastEventId:Se});if(e.dispatchEvent(fe),Y==="open"?oe(e,e.onopen,fe):Y==="message"?oe(e,e.onmessage,fe):Y==="error"&&oe(e,e.onerror,fe),X===T)return}se="",Y=""}U=G==="\r".charCodeAt(0)?R:m}else U===m&&(Fe=M,U=V),U===V?G===":".charCodeAt(0)&&(ie=M+1,U=pe):U===pe&&(U=Ge)}}},Le=function(x){if(X===h||X===i)X=c,j!==0&&(p(j),j=0),j=o(function(){Ee()},g),g=xe(Math.min(s*16,g*2)),e.readyState=i;else if(X===T&&x!=null){console.error(x);var I=new f("error",{error:x});e.dispatchEvent(I),oe(e,e.onerror,I)}},_e=function(){X=T,$!=null&&($.abort(),$=void 0),j!==0&&(p(j),j=0),e.readyState=T},Ee=function(){if(j=0,X!==c){if(!E&&$!=null)Le(new Error("No activity within "+v+" milliseconds. "+(X===i?"No response received.":y+" chars received.")+" Reconnecting.")),$!=null&&($.abort(),$=void 0);else{var x=Math.max((E||Date.now())+v-Date.now(),1);E=!1,j=o(function(){Ee()},x)}return}E=!1,y=0,j=o(function(){Ee()},v),X=i,se="",Y="",Se=w,be="",Fe=0,ie=0,U=m;var I=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&w!==""){var K=n.indexOf("?");I=K===-1?n:n.slice(0,K+1)+n.slice(K+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(Z,fe){return fe===u?"":Z}),I+=(n.indexOf("?")===-1?"?":"&")+u+"="+encodeURIComponent(w)}var G=e.withCredentials,B={};B.Accept="text/event-stream";var M=e.headers;if(M!=null)for(var Q in M)Object.prototype.hasOwnProperty.call(M,Q)&&(B[Q]=M[Q]);try{$=ge.open(W,Qe,Ze,Le,I,G,B)}catch(Z){throw _e(),Z}};e.url=n,e.readyState=i,e.withCredentials=t,e.headers=l,e._close=_e,Ee()}z.prototype=Object.create(re.prototype),z.prototype.CONNECTING=i,z.prototype.OPEN=h,z.prototype.CLOSED=T,z.prototype.close=function(){this._close()},z.CONNECTING=i,z.OPEN=h,z.CLOSED=T,z.prototype.withCredentials=void 0;var ke=k;d!=null&&(k==null||!("withCredentials"in k.prototype))&&(ke=z),function(e){if(typeof Re=="object"&&typeof Re.exports=="object"){var n=e(He);n!==void 0&&(Re.exports=n)}else typeof define=="function"&&define.amd?define(["exports"],e):e(r)}(function(e){e.EventSourcePolyfill=z,e.NativeEventSource=k,e.EventSource=ke})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:He:globalThis)});function Ve(r){this.message=r}Ve.prototype=new Error,Ve.prototype.name="InvalidCharacterError";var Pe=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(r){var o=String(r).replace(/=+$/,"");if(o.length%4==1)throw new Ve("'atob' failed: The string to be decoded is not correctly encoded.");for(var p,d,F=0,A=0,k="";d=o.charAt(A++);~d&&(p=F%4?64*p+d:d,F++%4)?k+=String.fromCharCode(255&p>>(-2*F&6)):0)d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(d);return k};function dt(r){var o=r.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(p){return decodeURIComponent(Pe(p).replace(/(.)/g,function(d,F){var A=F.charCodeAt(0).toString(16).toUpperCase();return A.length<2&&(A="0"+A),"%"+A}))}(o)}catch(p){return Pe(o)}}function Ce(r){this.message=r}function ct(r,o){if(typeof r!="string")throw new Ce("Invalid token specified");var p=(o=o||{}).header===!0?0:1;try{return JSON.parse(dt(r.split(".")[p]))}catch(d){throw new Ce("Invalid token specified: "+d.message)}}Ce.prototype=new Error,Ce.prototype.name="InvalidTokenError";var je=ct;function Ue(r){return{all:r=r||new Map,on:function(o,p){var d=r.get(o);d&&d.push(p)||r.set(o,[p])},off:function(o,p){var d=r.get(o);d&&d.splice(d.indexOf(p)>>>0,1)},emit:function(o,p){(r.get(o)||[]).slice().map(function(d){d(p)}),(r.get("*")||[]).slice().map(function(d){d(o,p)})}}}var Ke=ft(Be());var H;(function(r){r.READY="ready",r.CONNECTED="connected",r.DISCONNECTED="disconnected",r.CHANGED="changed",r.ERROR="error"})(H||(H={}));var $e={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},de=(r,...o)=>console.error(`[FF-SDK] ${r}`,...o),Ie=30*1e3;var ut="1.4.11",lt=500,Ae=globalThis.fetch,vt=Ke.EventSourcePolyfill,ye=!!globalThis.Proxy,Oe=r=>{let{value:o}=r;try{switch(r.kind.toLowerCase()){case"int":case"number":o=Number(o);break;case"boolean":o=o.toString().toLowerCase()==="true";break;case"json":o=JSON.parse(o);break}}catch(p){de(p)}return o},ht=(r,o,p)=>{let d,F,A,k,_,O=!0,q=()=>{O=!1},ce=()=>{O=!0},C=[],D=Ue(),J=te(te({},$e),p),N=(f,...c)=>{J.debug&&console.debug(`[FF-SDK] ${f}`,...c)},ne=f=>{if(O){let c=Date.now();c-f.lastAccessed>lt&&(f.count++,f.lastAccessed=c)}};globalThis.onbeforeunload=()=>{C.length&&globalThis.localStorage&&(q(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(C),ce())};let De=(f,c)=>Te(void 0,null,function*(){return(yield(yield Ae(`${c.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:f,target:o})})).json()).authToken}),L=()=>{if(C.length){N("Sending metrics...",{metrics:C,evaluations:b});let f={metricsData:C.map(c=>({timestamp:Date.now(),count:c.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:c.featureIdentifier},{key:"featureName",value:c.featureIdentifier},{key:"variationIdentifier",value:c.variationIdentifier},{key:"target",value:o.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:ut}]}))};Ae(`${J.eventUrl}/metrics/${d}?cluster=${F}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify(f)}).then(()=>{C=[]}).catch(c=>{N(c)}).finally(()=>{_=window.setTimeout(L,Ie)})}else _=window.setTimeout(L,Ie)},b={},ue=f=>{N("Sending event for",f.flag),ye?D.emit(H.CHANGED,new Proxy(f,{get(c,i){var h;if(c.hasOwnProperty(i)&&i==="value"){let T=c.flag,R=f.value,m=C.find(V=>V.featureIdentifier===T&&V.featureValue===R);m?(ne(m),m.variationIdentifier=((h=b[T])==null?void 0:h.identifier)||""):C.push({featureIdentifier:T,featureValue:String(R),variationIdentifier:b[T].identifier||"",count:O?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag",i,"has been read with value via stream update",R)}return i==="value"?Oe(f):f[i]}})):D.emit(H.CHANGED,{deleted:f.deleted,flag:f.flag,value:Oe(f)})},le=function(){return ye?new Proxy({},{get(f,c){var h,T,R;let i=f[c];if(f.hasOwnProperty(c)){let m=f[c],V=C.find(pe=>pe.featureIdentifier===c&&m===pe.featureValue);V?(V.variationIdentifier=((h=b[c])==null?void 0:h.identifier)||"",ne(V)):C.push({featureIdentifier:c,featureValue:m,variationIdentifier:((T=b[c])==null?void 0:T.identifier)||"",count:O?1:0,lastAccessed:Date.now()}),N("Metrics event: Flag:",c,"has been read with value:",m,"variationIdentifier:",(R=b[c])==null?void 0:R.identifier)}return i}}):{}},P=le();De(r,J).then(f=>{k=f;let c=je(f);if(N("Authenticated",c),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,N("Picking up metrics from previous session")}catch(i){}_=window.setTimeout(L,Ie),d=c.environment,F=c.clusterIdentifier,ve().then(()=>{N("Fetch all flags ok",P)}).then(()=>{re()}).then(()=>{N("Event stream ready",{storage:P}),D.emit(H.READY,te({},P)),ye||Object.keys(P).forEach(i=>{var h;C.push({featureIdentifier:i,featureValue:P[i],variationIdentifier:((h=b[i])==null?void 0:h.identifier)||"",count:O?1:0,lastAccessed:Date.now()})})}).catch(i=>{D.emit(H.ERROR,i)})}).catch(f=>{de("Authentication error: ",f),D.emit(H.ERROR,f)});let ve=()=>Te(void 0,null,function*(){try{(yield(yield Ae(`${J.baseUrl}/client/env/${d}/target/${o.identifier}/evaluations?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`}})).json()).forEach(i=>{let h=Oe(i),T=P[i.flag];h!==T&&(N("Flag variation has changed for ",i.identifier),P[i.flag]=h,b[i.flag]=te(te({},i),{value:h}),ue(i))})}catch(f){return de("Features fetch operation error: ",f),D.emit(H.ERROR,f),f}}),he=f=>Te(void 0,null,function*(){var c;try{let i=yield Ae(`${J.baseUrl}/client/env/${d}/target/${o.identifier}/evaluations/${f}?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`}});if(i.ok){let h=yield i.json(),T=Oe(h);if(q(),P[f]=T,b[f]=te(te({},h),{value:T}),ce(),ue(h),!ye){let R=h.flag,m=C.find(V=>V.featureIdentifier===R&&V.featureValue===h.value);m?(ne(m),m.variationIdentifier=((c=b[R])==null?void 0:c.identifier)||""):C.push({featureIdentifier:R,featureValue:String(h.value),variationIdentifier:b[R].identifier||"",count:O?1:0,lastAccessed:Date.now()})}}else D.emit(H.ERROR,i)}catch(i){de("Feature fetch operation error: ",i),D.emit(H.ERROR,i)}}),re=()=>{if(!J.streamEnabled){N("Stream is disabled by configuration. Note: Polling is not yet supported");return}A=new vt(`${J.baseUrl}/stream?cluster=${F}`,{headers:{Authorization:`Bearer ${k}`,"API-Key":r}}),A.onopen=i=>{N("Stream connected",i),D.emit(H.CONNECTED)},A.onclose=i=>{N("Stream disconnected"),D.emit(H.DISCONNECTED)},A.onerror=i=>{de("Stream has issue",i),D.emit(H.ERROR,i)};let f=i=>{switch(i.event){case"create":setTimeout(()=>he(i.identifier),1e3);break;case"patch":he(i.identifier);break;case"delete":delete P[i.identifier],D.emit(H.CHANGED,{flag:i.identifier,value:void 0,deleted:!0}),N("Evaluation deleted",{message:i,storage:P});break}},c=i=>{i.event==="patch"&&ve()};A.addEventListener("*",i=>{let h=JSON.parse(i.data);N("Received event from stream: ",h),h.domain==="flag"?f(h):h.domain==="target-segment"&&c(h)})},me=(f,c)=>D.on(f,c),ee=(f,c)=>{f?D.off(f,c):ae()},we=(f,c)=>{var h;let i=P[f];if(!ye&&i!==void 0){let T=i,R=f,m=C.find(V=>V.featureIdentifier===R&&V.featureValue===T);m?(ne(m),m.variationIdentifier=((h=b[R])==null?void 0:h.identifier)||""):C.push({featureIdentifier:R,featureValue:T,count:O?1:0,variationIdentifier:b[R].identifier||"",lastAccessed:Date.now()})}return i!==void 0?i:c},ae=()=>{N("Closing event stream"),P=le(),b={},clearTimeout(_),D.all.clear(),A.close()};return{on:me,off:ee,variation:we,close:ae}};export{H as Event,ht as initialize};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
//# sourceMappingURL=sdk.client.js.map
